<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DX MESH - Live Feed</title>
<style>
body {
  background-color: black;
  color: #FFAA33;
  font-family: 'Courier New', monospace;
  text-align: center;
  margin: 0;
  padding: 20px;
}
h1 { margin: 20px 0; font-size: 2.5em; }
h2 { margin: 10px 0; font-size: 1.5em; }
h3 { margin: 5px 0; }
.iframe-wrapper {
  text-align: center;
  margin: 15px 5px;
  border: 2px solid #FFAA33;
  border-radius: 8px;
  overflow: hidden;
  background-color: #331a00;
  width: 350px;
  display: inline-block;
}
.iframe-wrapper p {
  margin: 5px 5px 0;
  font-weight: bold;
  font-size: 1.1em;
}
iframe {
  border: none;
  width: 100%;
  height: 300px;
}
.hide-button {
  margin: 5px 0 10px 0;
  padding: 5px 10px;
  background-color: #ff0000;
  color: white;
  border: none;
  border-radius: 5px;
  cursor: pointer;
}
.hide-button:hover { background-color: #cc0000; }
.iframe-height-control { margin: 20px; font-size: 1.2em; }
</style>
</head>
<body>

<h1>THE DX MEGA MESH</h1>
<h2>Liam Cottle – Live Feed</h2>
<h3>Created by SubnetConflict.</h3>
<h3>Nicked by KD.</h3>

<h3 style="background-color:#B22222; color:#FFB347; display:inline-block; padding:5px 10px; border-radius:5px;">
⚠️ Please Consider Consulting Your Local Mesh Group And Fully Read The Meshtastic Role Guidance Before Selecting The Router Role ⚠️
</h3>
<h3>For Best Viewing On Smaller Landscape Screens Please Zoom Out Your Browser to 80%</h3>

<div style="margin: 20px auto; width: 90%; max-width: 800px; text-align: center;">
  <a href="https://willp618.github.io/westmidshelpfullinks">
    <button class="hide-button" style="background-color:#FFAA33; color:black;">Home</button>
  </a>
  <p style="color:#FFAA33; margin-top:5px;"><em>Edited: 14/10/25</em></p>
</div>

<div class="iframe-height-control">
  <label for="iframe-height">Adjust Message Box Height: </label>
  <input type="range" id="iframe-height" min="100" max="500" value="300">
  <span id="iframe-height-value">300px</span>
</div>

<div class="container" id="iframe-container">
  <p style="color:#FFAA33;">Loading live nodes…</p>
</div>

<script>
// Load iframe list dynamically like desktop
fetch('../iframe.html')
  .then(res => res.text())
  .then(html => {
    document.getElementById('iframe-container').innerHTML = html;

    // AFTER loading, make all titles uniform height
    const titles = document.querySelectorAll('.iframe-wrapper p');
    let maxHeight = 0;
    titles.forEach(t => {
      t.style.height = 'auto'; // reset first
      if(t.offsetHeight > maxHeight) maxHeight = t.offsetHeight;
    });
    titles.forEach(t => t.style.height = maxHeight + 'px');

    // Lazy-load iframes
    const observer = new IntersectionObserver(entries => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          const iframe = entry.target;
          if (!iframe.src) iframe.src = iframe.dataset.src;
          observer.unobserve(iframe);
        }
      });
    }, { threshold: 0.1 });
    document.querySelectorAll('iframe').forEach(iframe => observer.observe(iframe));
  })
  .catch(err => {
    console.error(err);
    document.getElementById('iframe-container').innerHTML =
      '<p style="color:red;">Failed to load node list.</p>';
  });

// Toggle iframe visibility
function toggleIframeVisibility(button) {
  const iframe = button.parentElement.querySelector('iframe');
  const isHidden = iframe.style.display === 'none';
  iframe.style.display = isHidden ? 'block' : 'none';
  button.textContent = isHidden ? 'Hide' : 'Show';
}

// Iframe height control
const iframeHeightSlider = document.getElementById('iframe-height');
const iframeHeightValue = document.getElementById('iframe-height-value');
iframeHeightSlider.addEventListener('input', function () {
  const height = iframeHeightSlider.value;
  iframeHeightValue.textContent = height + 'px';
  document.querySelectorAll('iframe').forEach(iframe => iframe.style.height = height + 'px');
});
</script>

</body>
</html>
